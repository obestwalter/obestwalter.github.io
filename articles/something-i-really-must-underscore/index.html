<!doctype html>
<html lang = "en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name=viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/static/normalize.css?h=7ffde343">
        <link rel="stylesheet" href="/static/style.css?h=35a44ed2">
        
        <link href="https://fonts.googleapis.com/css?family=Lakki+Reddy&display=swap" rel="stylesheet">
        <title>Something I really must underscore &mdash; obestwalter</title>
    </head>
    <body>

    <header>
        <div class="site-name"><a href="/">obestwalter</a></div>
        <nav>
            <ul>
                <li>
                    <a href="/">Home</a>
                </li>
                
                    <li  class="active">
                        <a href="/articles/">Articles</a>
                    </li>
                
                    <li >
                        <a href="/projects/">Projects</a>
                    </li>
                
                    <li >
                        <a href="/about/">About</a>
                    </li>
                
            </ul>
        </nav>
    </header>

    <main>
        










    
    <div id="something-i-really-must-underscore" class="title">
        <a href="">Something I really must underscore</a>
    </div>
    
        <div class="summary">
            <p><a href="https://en.wikipedia.org/wiki/Underscore"><img src="/articles/something-i-really-must-underscore/wikipedia-crop-underscore.png" alt="wikipedia: underscore"></a></p>
<p>The history of the underscore goes back to mechanical typewriters as a way to combine them with text in order to &#8230; <strong>surprise</strong> &#8230; underscore text. I don&#8217;t know whether it was due to inertia, backwards compatibility considerations, or the missing insight that underscoring text might work differently on computers, but whatever it was: the underscore made it into the original <a href="https://en.wikipedia.org/wiki/ASCII"><span class="caps">US</span>-<span class="caps">ASCII</span></a> character encoding standard in the 1960s and is here to stay. In Python it has also found many creative uses providing contextual information about a&nbsp;name.</p>

        </div>
    
    <p><code>_</code> doesn&#8217;t look like much, but as part of a name in Python it has a surprising amount of different&nbsp;meanings.</p>
<h1 id="make-names-more-readable">Make names more readable <a class="header-anchor" href="#make-names-more-readable">&#128279;</a></h1><p>We all know that we should use good names. This often makes it necessary to use more than one word to describe the thing. <code>cheese grater</code> is arguably a good name for a thing but it consists of two words in english<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">&thinsp;[1]</a></sup>. Like most programming languages Python <a href="https://docs.python.org/3/library/tokenize.html#module-tokenize">tokenizes</a> source code along white space. So, for the sake of readability the system needs to be tricked into believing that several words are one while still providing some kind of visual separation for the human reader. Born were constructs like <code>CheeseGrater</code> or <code>cheese_grater</code> - a.k.a. <a href="https://en.wikipedia.org/wiki/Camel_case">CamelCase</a> and <a href="https://en.wikipedia.org/wiki/Snake_case">snake_case</a>.</p>
<p>The <a href="https://www.python.org/dev/peps/pep-0008/"><span class="caps">PEP</span>-8</a> style guide is here to tell us - among other things - how to name things in a consistent&nbsp;manner.</p>
<div class="admonition-note"><p>I personally prefer <code>lowerCasedCamelCase</code> for local names bound to data and <code>snake_case</code> for names bound to functions. <a href="https://github.com/python/peps/pull/545">Until 2018</a> I wasn&#8217;t even technically violating <span class="caps">PEP</span>-8 when doing that. Since then I am a self confessed <span class="caps">PEP</span>-8 outlaw in personal projects and wherever I can get away with&nbsp;it.</p></div><h1 id="simply-_-:-it-needs-a-name-but-i-won-t-use-it">Simply <code>_</code>: it needs a name, but I won&#8217;t use it <a class="header-anchor" href="#simply-_-:-it-needs-a-name-but-i-won-t-use-it">&#128279;</a></h1><p>Using a single underscore as the complete name can be seen as a crutch. In certain situations it might be necessary to assign a name due to the nature of the language, but we&#8217;d rather not give it a name (because we won&#8217;t even be using it&nbsp;anyway).</p>
<h2 id="_-as-a-parameter-name"><code>_</code> as a parameter name <a class="header-anchor" href="#_-as-a-parameter-name">&#128279;</a></h2><p>Here we know that the function will always be called with three positional arguments but we don&#8217;t need the second&nbsp;one:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="n">spam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>[result]
4
</pre></div>
<p>There are often more elegant ways to deal with this depending on context, but sometimes this is still the easiest way to clearly communicate&nbsp;this.</p>
<p>To take one example and offer some unasked advice we could think of a primitive home baked plugin system that simply calls the client function with positional arguments. This could be improved by always using keyword arguments like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="n">spam</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>[result]
5
</pre></div>
<p>This way the client function can collect whatever arrives in an un<em>(derscore)</em>named catch-all dict also having more flexibility regarding future <span class="caps">API</span>&nbsp;changes.</p>
<p>What might be even better though is if the plugin system inspects the client function and calls it only with the requested parameters making this particular underscore crutch completely unnecessary<sup class="footnote-ref" id="fnref-2"><a href="#fn-2">&thinsp;[2]</a></sup>.</p>
<h2 id="_-as-a-local-name"><code>_</code> as a local name <a class="header-anchor" href="#_-as-a-local-name">&#128279;</a></h2><p>In the next example a tuple contains several items, but we are only interested in the first and the last one, so we collect whatever is in the middle and assign it to <code>_</code>:</p>
<div class="highlight"><pre><span></span><span class="n">left</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</pre></div>
<div class="highlight"><pre><span></span>[result]
(0, 4)
</pre></div>
<p>Also not uncommon: needing to repeat something a certain number of times without needing the iteration&nbsp;variable:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>[stdout]
hihihi
</pre></div>
<h2 id="the-exception:-_-in-an-interactive-shell">the exception: <code>_</code> in an interactive shell <a class="header-anchor" href="#the-exception:-_-in-an-interactive-shell">&#128279;</a></h2><p>There is one case where <code>_</code> can and should be used but is not manually&nbsp;assigned.</p>
<p>When you type <code>python</code> on the command line you enter the so-called <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop"><span class="caps">REPL</span></a>. The underscore grows a magic functionality here by always holding the result of the last&nbsp;evaluation.</p>
<p><img src="/articles/something-i-really-must-underscore/repl.png" alt="using underscore in a REPL"></p>
<div class="admonition-tip"><p>The <a href="https://ipython.org/">IPython</a> interactive shell takes this two steps further - it provides the last three evaluation results in <code>_</code>, <code>__</code> and <code>___</code>.</p></div><h2 id="_-as-prefix:-this-is-private-please-don-t-use-it"><code>_</code> as prefix: this is private, please don&#8217;t use it <a class="header-anchor" href="#_-as-prefix:-this-is-private-please-don-t-use-it">&#128279;</a></h2><div class="highlight"><pre><span></span><span class="n">_private_name</span> <span class="o">=</span> <span class="s2">&quot;Please don&#39;t access me from outside&quot;</span>
</pre></div>
<p>This has also one practical implication when used together with the <a href="/articles/python-is-made-of-star-stuff/#import-all-the-things">star import</a>: names that start with an underscore, are not imported in that&nbsp;case.</p>
<h2 id="_-as-postfix:-avoid-shadowing-of-names"><code>_</code> as postfix: avoid shadowing of names <a class="header-anchor" href="#_-as-postfix:-avoid-shadowing-of-names">&#128279;</a></h2><p>Names in Python can be freely reassigned. This is handy, but also a source of confusion and bugs. For that reason, static code analyzers warn you when you reassign the name of an inbuilt (e.g. <code>id</code>) or a name already defined in an outer scope. If I am determined to use such a name, I simply add an underscore like <code>id_</code> - which means: I know that this is shadowing an already defined name, but I still want to use it, so I mangle it just enough to be different. I am not sure how common this practice is, but I am pretty sure I didn&#8217;t come up with it&nbsp;myself.</p>
<div class="highlight"><pre><span></span><span class="n">id_</span> <span class="o">=</span> <span class="mi">123456</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{id(id_)=}&quot;</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>[stdout]
id(id_)=139908649732528
</pre></div>
<p>This is veering off the original topic a bit, but I just want to mention that whatever you do - the original object a builtin points to is never lost - just shadowed. When a module is initialized, the namespace of the <code>builtins</code><sup class="footnote-ref" id="fnref-3"><a href="#fn-3">&thinsp;[3]</a></sup> module is merged into the module. The objects can still be retrieved from <code>builtins</code> whenever&nbsp;necessary:</p>
<div class="highlight"><pre><span></span><span class="k">print</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;This won&#39;t work!&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="k">print</span> <span class="k">as</span> <span class="n">real_print</span>

    <span class="n">real_print</span><span class="p">(</span><span class="s2">&quot;Told you so ...&quot;</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>[stdout]
Told you so ...
</pre></div>
<div class="highlight"><pre><span></span><span class="k">print</span> <span class="o">=</span> <span class="n">real_print</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Now all is fine again.&quot;</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span>[stdout]
Now all is fine again.
</pre></div>
<h1 id="__-as-prefix-of-an-object-attribute:-mangle-the-name"><code>__</code> as prefix of an object attribute: mangle the name <a class="header-anchor" href="#__-as-prefix-of-an-object-attribute:-mangle-the-name">&#128279;</a></h1><p>In pairs the underscore turns from being an informal crutch to something that is part of Pythons execution model. If an object attribute starts with a double underscore (a.k.a. <code>dunder</code>), interesting things start to&nbsp;happen:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">__spam</span> <span class="o">=</span> <span class="s2">&quot;SPAM&quot;</span>

    <span class="k">def</span> <span class="nf">print_spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{self.__spam=}, {id(self)=}&quot;</span><span class="p">)</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">print_spam</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span>[stdout]
self.__spam=&#39;SPAM&#39;, id(self)=139908631077984
</pre></div>
<p>Up to this point there is nothing unusual about this. When I try to access the attribute from outside though, the behaviour is different as when accessed from inside the object although <code>a</code> and <code>self</code> are the exact same object (as can be seen from the printed&nbsp;id):</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{id(a)=}&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">__spam</span>
</pre></div>
<div class="highlight"><pre><span></span>[stdout]
id(a)=139908631077984
</pre></div>
<div class="highlight"><pre><span></span>[AttributeError]
&#39;A&#39; object has no attribute &#39;__spam&#39;
</pre></div>
<p>To access the original attribute, I have to know the secret name mangling formula which simplified is <code>_&lt;class name&gt;&lt;attribute name&gt;</code>:</p>
<div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">_A__spam</span>
</pre></div>
<div class="highlight"><pre><span></span>[result]
&#39;SPAM&#39;
</pre></div>
<p>The <a href="https://docs.python.org/3/tutorial/classes.html#private-variables">Python docs</a> have this to say about&nbsp;it:</p>
<blockquote><p>Since there is a valid use-case for class-private members (namely to avoid name clashes of names with names defined by subclasses), there is limited support for such a mechanism, called name mangling. Any identifier of the form <code>__spam</code> (at least two leading underscores, at most one trailing underscore) is textually replaced with <code>_classname__spam</code>, where classname is the current class name with leading underscore(s) stripped. This mangling is done without regard to the syntactic position of the identifier, as long as it occurs within the definition of a&nbsp;class.</p>
<p>Name mangling is helpful for letting subclasses override methods without breaking intraclass method&nbsp;calls.</p>
</blockquote>
<h1 id="__magic__-:-part-of-the-language-mechanics"><code>__magic__</code>: part of the language mechanics <a class="header-anchor" href="#__magic__-:-part-of-the-language-mechanics">&#128279;</a></h1><p>When something starts and ends with a double underscore things get really serious. <a href="https://docs.python.org/3/reference/datamodel.html#special-method-names">Special methods</a> and <a href="https://docs.python.org/3/reference/import.html#import-related-module-attributes">special attributes</a> are everywhere and they are a big part of Pythons special&nbsp;sauce.</p>
<p>It starts with simple module attributes that reveal information about state and internals (e.g. <code>__name__</code> and <code>__file__</code>) and ends with protocols that can be used to hook into the language mechanics like e.g. creating a context manager by implementing <a href="https://docs.python.org/3/reference/datamodel.html#with-statement-context-managers"><code>__enter__</code> and <code>__exit__</code></a> on an&nbsp;object.</p>
<p>I won&#8217;t go into more details here as this would far exceed the scope of this innocent little article about the underscore, but I&#8217;ll leave a warning&nbsp;here:</p>
<div class="admonition-warning"><p>This kind of naming scheme should be regarded as strictly Python internal. You usually don&#8217;t want to use this for names in your own programs (there are exceptions to that rule though as usual<sup class="footnote-ref" id="fnref-4"><a href="#fn-4">&thinsp;[4]</a></sup>).</p></div><p>Enough underscores for today, I would say. If you know of other conventions and uses of the underscore, please <a href="/about/#get-in-touch">let me know</a>.</p>
<div class="footnotes">
<ol><li id="fn-1"><p>We wouldn&#8217;t have a problem like that if we used german names, where this would be a <code>käsehobel</code>. Especially in german law, words like <em>Vermögens&shy;zuordnungs&shy;zuständigkeits&shy;übertragungs&shy;verordnung</em> are used unironically.<a href="#fnref-1" class="footnote">&nbsp;[&#10548;]</a></p></li>
<li id="fn-2"><p>Have a look at <a href="https://github.com/pytest-dev/pluggy">pluggy</a> if you are interested in how this is accomplished.<a href="#fnref-2" class="footnote">&nbsp;[&#10548;]</a></p></li>
<li id="fn-3"><p>While we are talking about <code>builtins</code> in the context of underscores: the <code>__builtins__</code> attribute is already available in the module namespace but it is not recommended to use it directly as it is a <a href="https://docs.python.org/3/reference/executionmodel.html#builtins-and-restricted-execution">CPython implementation detail</a><a href="#fnref-3" class="footnote">&nbsp;[&#10548;]</a></p></li>
<li id="fn-4"><p>See e.g. pytest using <code>__tracebackhide__</code> as a function local name in order to instruct pytest to <a href="https://docs.pytest.org/en/latest/example/simple.html#writing-well-integrated-assertion-helpers">hide a function from a traceback</a><a href="#fnref-4" class="footnote">&nbsp;[&#10548;]</a></p></li>
</ol>
</div>

    
        
    <div class="info">
        
    
        <a href="/articles/tag/python">
                <span class="tag">python</span>
            </a>
        <a href="/articles/tag/fundamentals">
                <span class="tag">fundamentals</span>
            </a>
        <a href="/articles/tag/little-things">
                <span class="tag">little-things</span>
            </a>
        
    

        
    <span class="date" title="published: ">
        [last update: 2019-11-03]
    </span>

    </div>

    


    </main>

    <footer>
        <div class="origin-hint">
        
            generated from Jupyter notebook &mdash;
            
                <a href="https://github.com/obestwalter/obestwalter.github.io/tree/lektor-sources/content/articles/something-i-really-must-underscore">
                    view sources
                </a>
            
        
        </div>
        <br>
        <div class="left"><a href="https://github.com/obestwalter/obestwalter.github.io/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc">comment</a></div>
        <div class="right"><a href="https://github.com/obestwalter/obestwalter.github.io/tree/lektor-sources/content/LICENSE">&copy; Oliver Bestwalter</a></div>
    </footer>

    </body>
</html>
